var $url="/settings/sites",$urlUpdate=$url+"/actions/update",$urlDelete=$url+"/actions/delete",data=utils.init({siteTypes:null,sites:null,rootSiteId:null,tableNames:null,site:null,editPanel:!1,editForm:null,editLoading:!1,editRules:{siteName:[{required:!0,message:"请输入站点名称",trigger:"blur"}],siteDir:[{required:!0,message:"请输入文件夹名称",trigger:"blur"}],taxis:[{required:!0,message:"请输入正确的站点排序",trigger:"blur"}]},deletePanel:!1,deleteForm:null,deleteLoading:!1}),methods={getSiteType:function(e){return(e=this.siteTypes.find(function(t){return t.id===e}))?e.text:"网站"},apiGet:function(){var e=this;$api.get($url).then(function(t){var i=t.data;e.siteTypes=i.siteTypes,e.sites=i.sites,e.rootSiteId=i.rootSiteId,e.tableNames=i.tableNames}).catch(function(e){utils.error(e)}).then(function(){utils.loading(e,!1)})},apiDelete:function(){var e=this;$api.post($urlDelete,this.deleteForm).then(function(t){var i=t.data;e.sites=i.sites,e.deletePanel=!1,setTimeout(function(){window.top.location.href=utils.getIndexUrl()},1500)}).catch(function(e){utils.error(e)}).then(function(){e.deleteLoading=!1})},apiEdit:function(){var e=this;$api.post($urlUpdate,this.editForm).then(function(t){var i=t.data;e.sites=i.sites,e.editPanel=!1}).catch(function(e){utils.error(e)}).then(function(){e.editLoading=!1})},btnAddClick:function(){utils.addTab("创建新站点",utils.getSettingsUrl("sitesAdd"))},btnSaveClick:function(e){utils.addTab("保存站点模板",utils.getSettingsUrl("sitesSave",{siteId:e.id}))},btnChangeClick:function(e){var t=e.root?"转移到子目录":"转移到根目录";utils.addTab(t,utils.getSettingsUrl("sitesChangeRoot",{siteId:e.id}))},btnEditClick:function(e){this.editForm={siteId:e.id,root:e.root,siteName:e.siteName,siteType:e.siteType,siteDir:e.siteDir,parentId:e.parentId,taxis:e.taxis,tableRule:"Choose",tableChoose:e.tableName,tableHandWrite:""},this.editPanel=!0},btnEditCancelClick:function(){this.editPanel=!1,this.editLoading=!1},btnEditSubmitClick:function(){var e=this;this.$refs.editForm.validate(function(t){t&&(e.editLoading=!0,e.apiEdit())})},btnDeleteClick:function(e){var t=e;this.deleteForm={siteId:t.id,siteName:t.siteName,dir:t.siteDir,siteDir:null,deleteFiles:!0},this.deletePanel=!0},btnDeleteCancelClick:function(){this.deletePanel=!1,this.deleteLoading=!1},btnDeleteSubmitClick:function(){var e=this;this.$refs.deleteForm.validate(function(t){t&&(e.deleteLoading=!0,e.apiDelete())})},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var e=this;utils.keyPress(function(){e.editPanel?e.btnEditSubmitClick():e.deletePanel&&e.btnDeleteSubmitClick()},function(){e.editPanel?e.btnEditCancelClick():e.deletePanel?e.btnDeleteCancelClick():e.btnCloseClick()}),this.apiGet()}});